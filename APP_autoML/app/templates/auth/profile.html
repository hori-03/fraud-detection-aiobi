{% extends "base.html" %}

{% block title %}Mon Profil - Aïobi{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto fade-in-up">
    <h1 class="text-3xl font-bold gradient-aiobi-text mb-8">
        <i class="fas fa-user-circle mr-3"></i>Mon Profil
    </h1>
    
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
        <!-- Profile Info Card -->
        <div class="lg:col-span-1">
            <div class="card-aiobi p-6">
                <div class="flex flex-col items-center">
                    <div class="h-24 w-24 rounded-full bg-black flex items-center justify-center text-white text-4xl font-bold">
                        {{ current_user.username[0]|upper }}
                    </div>
                    <h2 class="mt-4 text-xl font-semibold text-white">{{ current_user.username }}</h2>
                    <p class="text-sm text-gray-500">{{ current_user.email }}</p>
                    {% if current_user.company %}
                    <p class="text-sm text-gray-500"><i class="fas fa-building mr-1"></i>{{ current_user.company }}</p>
                    {% endif %}
                    
                    {% set active_license = current_user.get_active_license() %}
                    <div class="mt-4 w-full">
                        {% if active_license %}
                        <span class="badge-aiobi w-full justify-center
                            {% if active_license.license_type == 'trial' %}bg-yellow-100 text-yellow-800 border-yellow-300
                            {% elif active_license.license_type == 'basic' %}bg-blue-100 text-blue-800 border-blue-300
                            {% elif active_license.license_type == 'premium' %}bg-purple-100 text-purple-800 border-purple-300
                            {% elif active_license.license_type == 'enterprise' %}badge-aiobi-black
                            {% endif %}">
                            <i class="fas fa-crown mr-2"></i>
                            {{ active_license.license_type|upper }}
                        </span>
                        {% else %}
                        <a href="{{ url_for('auth.license_activation') }}" class="badge-aiobi w-full justify-center bg-red-100 text-red-800 border-red-300 hover:bg-red-200">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Activer une licence
                        </a>
                        {% endif %}
                    </div>
                    
                    <div class="mt-4 text-center text-sm text-gray-600">
                        <p>Membre depuis</p>
                        <p class="font-semibold">{{ current_user.created_at.strftime('%d/%m/%Y') }}</p>
                    </div>
                </div>
            </div>
            
            <!-- License Info -->
            <div class="card-aiobi p-6 mt-6">
                <h3 class="text-lg font-semibold text-white mb-4">
                    <i class="fas fa-ticket-alt mr-2"></i>Informations Licence
                </h3>
                {% if active_license %}
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Type:</span>
                        <span class="font-semibold">{{ active_license.license_type|upper }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Expiration:</span>
                        <span class="font-semibold">
                            {% if active_license.expires_at %}
                                {{ active_license.expires_at.strftime('%d/%m/%Y') }}
                            {% else %}
                                Jamais
                            {% endif %}
                        </span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Jours restants:</span>
                        <span class="font-semibold {% if active_license.days_remaining() and active_license.days_remaining() <= 7 %}text-red-600{% endif %}">
                            {% if active_license.days_remaining() %}
                                {{ active_license.days_remaining() }} jours
                            {% else %}
                                Illimité
                            {% endif %}
                        </span>
                    </div>
                    <hr>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Modèles max:</span>
                        <span class="font-semibold">{{ active_license.max_models }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Dataset max:</span>
                        <span class="font-semibold">{{ active_license.max_datasets_size_mb }} MB</span>
                    </div>
                </div>
                
                {% if active_license.days_remaining() and active_license.days_remaining() <= 7 %}
                <div class="mt-4">
                    <a href="{{ url_for('auth.license_activation') }}" class="btn-aiobi-secondary w-full text-center">
                        <i class="fas fa-arrow-up mr-2"></i>Renouveler ma licence
                    </a>
                </div>
                {% endif %}
                {% else %}
                <div class="text-center py-8">
                    <i class="fas fa-exclamation-circle text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-4">Aucune licence active</p>
                    <a href="{{ url_for('auth.license_activation') }}" class="btn-aiobi-primary inline-flex items-center">
                        <i class="fas fa-plus mr-2"></i>Activer une licence
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Edit Forms -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Update Profile -->
            <div class="card-aiobi p-6">
                <h3 class="text-lg font-semibold text-white mb-4">
                    <i class="fas fa-edit mr-2"></i>Modifier le profil
                </h3>
                <form method="POST" action="{{ url_for('auth.update_profile') }}" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-white mb-2">
                            <i class="fas fa-user mr-2"></i>Nom d'utilisateur
                        </label>
                        <input type="text" 
                               id="username" 
                               name="username" 
                               value="{{ current_user.username }}"
                               class="input-aiobi w-full">
                    </div>
                    
                    <div>
                        <label for="company" class="block text-sm font-medium text-white mb-2">
                            <i class="fas fa-building mr-2"></i>Entreprise
                        </label>
                        <input type="text" 
                               id="company" 
                               name="company" 
                               value="{{ current_user.company or '' }}"
                               class="input-aiobi w-full">
                    </div>
                    
                    <div>
                        <button type="submit" class="btn-aiobi-primary">
                            <i class="fas fa-save mr-2"></i>Sauvegarder
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Change Password -->
            <div class="card-aiobi p-6">
                <h3 class="text-lg font-semibold text-white mb-4">
                    <i class="fas fa-key mr-2"></i>Changer le mot de passe
                </h3>
                <form method="POST" action="{{ url_for('auth.change_password') }}" class="space-y-4">
                    <div>
                        <label for="current_password" class="block text-sm font-medium text-white mb-2">
                            <i class="fas fa-lock mr-2"></i>Mot de passe actuel
                        </label>
                        <input type="password" 
                               id="current_password" 
                               name="current_password" 
                               required
                               class="input-aiobi w-full">
                    </div>
                    
                    <div>
                        <label for="new_password" class="block text-sm font-medium text-white mb-2">
                            <i class="fas fa-lock mr-2"></i>Nouveau mot de passe
                        </label>
                        <input type="password" 
                               id="new_password" 
                               name="new_password" 
                               required
                               minlength="8"
                               class="input-aiobi w-full">
                        <p class="mt-1 text-xs text-gray-400">Minimum 8 caractères</p>
                    </div>
                    
                    <div>
                        <label for="confirm_password" class="block text-sm font-medium text-white mb-2">
                            <i class="fas fa-check-circle mr-2"></i>Confirmer le nouveau mot de passe
                        </label>
                        <input type="password" 
                               id="confirm_password" 
                               name="confirm_password" 
                               required
                               class="input-aiobi w-full">
                    </div>
                    
                    <div>
                        <button type="submit" class="btn-aiobi-primary bg-red-600 hover:bg-red-700 border-red-600">
                            <i class="fas fa-lock mr-2"></i>Changer le mot de passe
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Account Stats -->
            <div class="card-aiobi p-6">
                <h3 class="text-lg font-semibold text-white mb-4">
                    <i class="fas fa-chart-bar mr-2"></i>Statistiques du compte
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-gray-800 rounded-lg border-2 border-gray-700">
                        <p class="text-2xl font-bold text-white">{{ current_user.training_history|length }}</p>
                        <p class="text-sm text-gray-400">Entraînements</p>
                    </div>
                    <div class="text-center p-4 bg-gray-800 rounded-lg border-2 border-gray-700">
                        <p class="text-2xl font-bold text-white">
                            {{ current_user.training_history|selectattr('status', 'equalto', 'completed')|list|length }}
                        </p>
                        <p class="text-sm text-gray-400">Modèles actifs</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
