<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}A√Øobi - Fraud Detection{% endblock %}</title>
    
    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- Tailwind CSS CDN with caching -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome (minified) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- A√Øobi Theme CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/aiobi-theme.css') }}">
    
    <!-- üé® Animations CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    
    <!-- Alpine.js (defer for non-blocking) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- ‚ú® Animations JavaScript -->
    <script defer src="{{ url_for('static', filename='js/animations.js') }}"></script>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-900">
    
    {% if current_user.is_authenticated %}
    <!-- Navigation A√Øobi -->
    <nav class="nav-aiobi shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <!-- Logo A√Øobi -->
                    <div class="flex-shrink-0 flex items-center">
                        <a href="{{ url_for('dashboard.index') }}" class="flex items-center space-x-3 smooth-transition hover-scale">
                            <img src="{{ url_for('static', filename='images/Aiobi.jpeg') }}" alt="A√Øobi Logo" class="h-14 w-auto rounded-lg">
                            <span class="text-xl font-bold text-white hidden sm:block">A√Øobi</span>
                        </a>
                    </div>
                    
                    <!-- Navigation Links -->
                    <div class="hidden sm:ml-8 sm:flex sm:space-x-6">
                        <a href="{{ url_for('dashboard.index') }}" 
                           class="nav-link-aiobi {% if request.endpoint == 'dashboard.index' %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-home mr-2 icon-bounce"></i> Dashboard
                        </a>
                        
                        <a href="{{ url_for('dashboard.upload_page') }}" 
                           class="nav-link-aiobi {% if request.endpoint == 'dashboard.upload_page' %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-upload mr-2 icon-bounce"></i> Upload
                        </a>
                        
                        <a href="{{ url_for('dashboard.models_page') }}" 
                           class="nav-link-aiobi {% if request.endpoint == 'dashboard.models_page' %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-brain mr-2 icon-bounce"></i> Mod√®les
                        </a>
                        
                        <a href="{{ url_for('dashboard.predict_page') }}" 
                           class="nav-link-aiobi {% if request.endpoint == 'dashboard.predict_page' %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-chart-line mr-2 icon-bounce"></i> Pr√©dire
                        </a>
                        
                        <a href="{{ url_for('dashboard.history_page') }}" 
                           class="nav-link-aiobi {% if request.endpoint == 'dashboard.history_page' %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-history mr-2 icon-bounce"></i> Historique
                        </a>
                        
                        {% if current_user.is_admin %}
                        <a href="{{ url_for('admin.index') }}" 
                           class="nav-link-aiobi {% if request.endpoint and request.endpoint.startswith('admin.') %}active{% endif %} inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium smooth-transition">
                            <i class="fas fa-shield-alt mr-2 icon-bounce"></i> Admin
                        </a>
                        {% endif %}
                    </div>
                </div>
                
                <!-- User menu -->
                <div class="flex items-center space-x-4">
                    <!-- License Badge -->
                    <div>
                        {% set active_license = current_user.get_active_license() %}
                        {% if active_license %}
                        <a href="{{ url_for('auth.license_activation') }}" class="badge-aiobi smooth-transition hover-glow cursor-pointer
                            {% if active_license.license_type == 'trial' %}bg-yellow-100 text-yellow-800 border-yellow-300 badge-pulse
                            {% elif active_license.license_type == 'basic' %}bg-blue-100 text-blue-800 border-blue-300
                            {% elif active_license.license_type == 'premium' %}bg-purple-100 text-purple-800 border-purple-300 badge-glow
                            {% elif active_license.license_type == 'enterprise' %}badge-aiobi-black badge-glow
                            {% endif %}">
                            <i class="fas fa-crown mr-1 icon-spin"></i>
                            {{ active_license.license_type|upper }}
                            {% if active_license.days_remaining() and active_license.days_remaining() <= 7 %}
                                ({{ active_license.days_remaining() }}j)
                            {% endif %}
                        </a>
                        {% else %}
                        <a href="{{ url_for('auth.license_activation') }}" class="badge-aiobi bg-red-100 text-red-800 border-red-300 hover:bg-red-200 badge-pulse smooth-transition">
                            <i class="fas fa-exclamation-triangle mr-1 icon-shake"></i>
                            Aucune licence
                        </a>
                        {% endif %}
                    </div>
                    
                    <!-- Dropdown menu -->
                    <div class="relative z-50" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white">
                            <div class="h-8 w-8 rounded-full bg-white flex items-center justify-center text-black font-semibold">
                                {{ current_user.username[0]|upper }}
                            </div>
                            <span class="ml-2 text-white font-medium">{{ current_user.username }}</span>
                            <i class="fas fa-chevron-down ml-2 text-gray-300"></i>
                        </button>
                        
                        <div x-show="open" 
                             @click.away="open = false"
                             x-transition:enter="transition ease-out duration-100"
                             x-transition:enter-start="transform opacity-0 scale-95"
                             x-transition:enter-end="transform opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="transform opacity-100 scale-100"
                             x-transition:leave-end="transform opacity-0 scale-95"
                             class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-gray-800 ring-1 ring-gray-700 z-50">
                            <div class="py-1">
                                <a href="{{ url_for('auth.profile') }}" class="block px-4 py-2 text-sm text-white hover:bg-gray-700">
                                    <i class="fas fa-user mr-2"></i> Mon Profil
                                </a>
                                <a href="{{ url_for('dashboard.settings_page') }}" class="block px-4 py-2 text-sm text-white hover:bg-gray-700">
                                    <i class="fas fa-cog mr-2"></i> Param√®tres
                                </a>
                                <hr class="my-1 border-gray-700">
                                <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 text-sm text-red-500 hover:bg-gray-700">
                                    <i class="fas fa-sign-out-alt mr-2"></i> D√©connexion
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div class="sm:hidden" x-data="{ mobileOpen: false }">
            <button @click="mobileOpen = !mobileOpen" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100">
                <i class="fas fa-bars"></i>
            </button>
            
            <div x-show="mobileOpen" class="pt-2 pb-3 space-y-1">
                <a href="{{ url_for('dashboard.index') }}" class="block pl-3 pr-4 py-2 border-l-4 border-indigo-500 text-base font-medium text-indigo-700 bg-indigo-50">
                    Dashboard
                </a>
                <!-- Add more mobile links -->
            </div>
        </div>
    </nav>
    {% endif %}
    
    <!-- Flash Messages -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="rounded-md p-4 mb-4 
                    {% if category == 'error' %}bg-red-50 border border-red-200
                    {% elif category == 'success' %}bg-green-50 border border-green-200
                    {% elif category == 'warning' %}bg-yellow-50 border border-yellow-200
                    {% else %}bg-blue-50 border border-blue-200{% endif %}">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas 
                                {% if category == 'error' %}fa-exclamation-circle text-red-400
                                {% elif category == 'success' %}fa-check-circle text-green-400
                                {% elif category == 'warning' %}fa-exclamation-triangle text-yellow-400
                                {% else %}fa-info-circle text-blue-400{% endif %}"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium 
                                {% if category == 'error' %}text-red-800
                                {% elif category == 'success' %}text-green-800
                                {% elif category == 'warning' %}text-yellow-800
                                {% else %}text-blue-800{% endif %}">
                                {{ message }}
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-transparent mt-12">
        <div class="max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-gray-600 text-xs opacity-70">
                ¬© 2025 AutoML Fraud Detection. Powered by Meta-Transformer.
            </p>
        </div>
    </footer>
    
    <!-- Alpine.js for interactive components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
